# Social Cards System

## Overview

The social cards system for contributor.info generates dynamic Open Graph and Twitter Card images for social media sharing. The system has been migrated from Netlify Edge Functions to a dedicated Fly.io service for improved reliability and performance.

## Current Architecture (Fly.io)

### Service Details
- **URL**: https://contributor-info-social-cards.fly.dev
- **Technology**: Node.js/Express with optimized SVG generation
- **Data Source**: Real-time Supabase integration
- **Response Time**: < 2 seconds (target: < 100ms for generation)
- **Uptime Target**: 99.9%

### Endpoints

#### Health Check
```
GET https://contributor-info-social-cards.fly.dev/health
```

#### Metrics
```
GET https://contributor-info-social-cards.fly.dev/metrics
```

#### Social Card Generation

**Home Page Card**
```
GET https://contributor-info-social-cards.fly.dev/social-cards/home
```

**Repository Card**
```
GET https://contributor-info-social-cards.fly.dev/social-cards/repo?owner={owner}&repo={repo}
```

**User Card**
```
GET https://contributor-info-social-cards.fly.dev/social-cards/user?username={username}
```

## Card Types

### 1. Home Card
- **Purpose**: Main social preview for the homepage
- **Dimensions**: 1200x630px
- **Content**: Site branding, global statistics (repositories, contributors, PRs)
- **Data**: Real-time from Supabase

### 2. Repository Card
- **Purpose**: Dynamic preview for repository pages
- **Dimensions**: 1200x630px
- **Content**: Repository stats, weekly PR volume, active contributors
- **Data**: Real-time repository metrics from Supabase

### 3. User Card
- **Purpose**: Preview for user profile pages
- **Dimensions**: 1200x630px
- **Content**: User stats, contribution metrics
- **Data**: Real-time user data from Supabase

## Platform Compatibility

All cards are optimized for:
- **Twitter**: summary_large_image (1200x630px)
- **Facebook**: Open Graph (1200x630px)
- **LinkedIn**: 1200x627px minimum
- **Discord/Slack**: Auto-preview with Open Graph

## Performance

### Current Metrics
- **Generation Time**: < 100ms
- **Response Time**: < 2 seconds
- **Cache Headers**: 1 hour client, 24 hours CDN
- **File Format**: SVG (lightweight, scalable)

### Caching Strategy
- **Client Cache**: 1 hour (Cache-Control: public, max-age=3600)
- **CDN Cache**: 24 hours (s-maxage=86400)
- **Data Freshness**: Real-time from database

## Implementation

### Meta Tags Integration

The meta tags are automatically generated by the `MetaTagsProvider` component:

```typescript
// src/components/common/layout/meta-tags-provider.tsx
const socialCardsBaseUrl = 'https://contributor-info-social-cards.fly.dev';

// For repository pages
imageUrl = `${socialCardsBaseUrl}/social-cards/repo?owner=${owner}&repo=${repo}`;

// For user pages
imageUrl = `${socialCardsBaseUrl}/social-cards/user?username=${username}`;

// For home page
imageUrl = `${socialCardsBaseUrl}/social-cards/home`;
```

### Testing Social Cards

1. **Twitter Card Validator**
   - Visit: https://cards-dev.twitter.com/validator
   - Enter your page URL

2. **Facebook Sharing Debugger**
   - Visit: https://developers.facebook.com/tools/debug/
   - Enter your page URL

3. **LinkedIn Post Inspector**
   - Visit: https://www.linkedin.com/post-inspector/
   - Enter your page URL

## Deployment

### Fly.io Service

The service is automatically deployed via GitHub Actions on push to main:

```yaml
# .github/workflows/deploy-social-cards.yml
- Builds Docker container
- Deploys to Fly.io
- Runs health checks
- Tests card generation
```

### Manual Deployment

```bash
cd fly-social-cards
./deploy.sh
```

### Environment Variables

Required secrets (set in Fly.io):
- `SUPABASE_URL`: Your Supabase project URL
- `SUPABASE_ANON_KEY`: Supabase anonymous key

## Monitoring

### Health Monitoring
- Endpoint: `/health`
- Checks: Service status, database connectivity
- Frequency: Every 10 seconds

### Metrics
- Endpoint: `/metrics`
- Data: Request count, response times, cache statistics

### Logs
```bash
fly logs -a contributor-info-social-cards
```

## Troubleshooting

### Common Issues

**Cards not loading**
1. Check service health: https://contributor-info-social-cards.fly.dev/health
2. Verify Fly.io status: `fly status -a contributor-info-social-cards`
3. Check logs: `fly logs -a contributor-info-social-cards`

**Data not updating**
1. Verify Supabase connection
2. Check database queries in logs
3. Confirm cache headers are appropriate

**Platform not showing cards**
1. Use platform validators (Twitter, Facebook, LinkedIn)
2. Clear platform cache (Facebook Debugger has "Scrape Again" button)
3. Verify meta tags are present in HTML

## Migration History

### Previous Implementation (Deprecated)
- **Platform**: Netlify Edge Functions
- **Issues**: Timeouts, cold starts, mock data only
- **Status**: Removed due to unreliability

### Current Implementation
- **Platform**: Fly.io
- **Improvements**: Real data, better performance, 99.9% uptime
- **Migration Date**: January 2025

## Future Enhancements

### Planned
- [ ] WebP format support for better compression
- [ ] User avatar integration
- [ ] Custom themes per repository
- [ ] Analytics tracking

### Considered
- [ ] Animated cards for supported platforms
- [ ] Multi-language support
- [ ] A/B testing different designs
- [ ] Real-time preview in admin

## Related Documentation

- [Fly.io Service README](/fly-social-cards/README.md)
- [Migration Guide](/docs/migration/social-cards-fly-migration.md)
- [Meta Tags Provider](/src/components/common/layout/meta-tags-provider.tsx)

## Support

For issues with social cards:
1. Check service status
2. Review logs
3. Open an issue with details