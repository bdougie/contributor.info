# Console.log Template Literal Security Fix

## Date: August 22, 2024

## Issue
Security vulnerability identified in PR #495: Template literals in `console.log` statements can be exploited for log injection attacks.

### Vulnerability Pattern
```javascript
// VULNERABLE - user input can inject format specifiers
console.log(`Processing ${userInput} for ${repo}`);
```

### Attack Vector
If `userInput` contains format specifiers like `%s` or `%d`, it could cause unexpected behavior or crashes when the log is processed by monitoring tools.

## Solution
Replace template literals with parameterized logging using format specifiers:

```javascript
// SECURE - user input is safely escaped
console.log('Processing %s for %s', userInput, repo);
```

## Files Fixed

### Critical Application Files
- `supabase/functions/github-backfill/index.ts` - 6 vulnerabilities fixed
- `netlify/functions/widget-stat-card.mjs` - 3 vulnerabilities fixed  
- `app/services/logger.ts` - 8 vulnerabilities fixed (core logging service)
- `app/webhooks/pull-request-direct.ts` - 8 vulnerabilities fixed
- `app/webhooks/labeled.ts` - 1 vulnerability fixed

### Additional Files Fixed (22 files)
- All webhook handlers in `app/webhooks/`
- Supabase Edge Functions
- Netlify Functions
- GitHub workflow files
- Service layer files

## Pattern Applied

### Single Variable
```javascript
// Before
console.log(`Text ${variable}`);

// After  
console.log('Text %s', variable);
```

### Multiple Variables
```javascript
// Before
console.log(`Processing ${owner}/${repo} with ${count} items`);

// After
console.log('Processing %s/%s with %d items', owner, repo, count);
```

### With Objects
```javascript
// Before
console.log(`Data: ${JSON.stringify(obj)}`);

// After
console.log('Data: %s', JSON.stringify(obj));
```

## Format Specifiers Used
- `%s` - String values
- `%d` - Numbers (integers)
- `%o` - Objects (for debugging)

## Testing
- ✅ Build passes after fixes
- ✅ No TypeScript errors
- ✅ Console output format unchanged
- ✅ Security vulnerability resolved

## Prevention

### Linting Rule
Consider adding an ESLint rule to prevent future vulnerabilities:

```javascript
// .eslintrc.js
{
  "rules": {
    "no-template-curly-in-string": "error",
    // Custom rule to detect console.log with template literals
  }
}
```

### Code Review Checklist
- [ ] No template literals in console.log/warn/error
- [ ] Use format specifiers for dynamic values
- [ ] Never directly interpolate user input in logs

## Scripts Created
- `/scripts/fix-console-log-security.cjs` - Automated fix script
- `/scripts/fix-remaining-console-logs.cjs` - Secondary fix script
- `/scripts/fix-all-console-vulnerabilities.sh` - Shell script for batch fixes

## Recommendation
1. Add pre-commit hook to check for this pattern
2. Update developer guidelines in CLAUDE.md
3. Consider using a structured logging library for production

## References
- [OWASP Log Injection](https://owasp.org/www-community/attacks/Log_Injection)
- [Node.js Console Documentation](https://nodejs.org/api/console.html)
- PR #495 Comment: https://github.com/bdougie/contributor.info/pull/495#issuecomment-3215468519