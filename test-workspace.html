<!DOCTYPE html>
<html>
<head>
    <title>Test Workspace Loading</title>
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
        
        const supabaseUrl = 'https://egcxzonpmmcirmgqdrla.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVnY3h6b25wbW1jaXJtZ3FkcmxhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIxODAzNzEsImV4cCI6MjA2Nzc1NjM3MX0.SY1LMsRFyrBtHiZfgDhXD9ZlKl37-L7Uar4HnyDgw24';
        
        const supabase = createClient(supabaseUrl, supabaseKey);
        
        async function testWorkspaceQuery() {
            console.log('Testing workspace query...');
            
            // Get current user
            const { data: { user }, error: authError } = await supabase.auth.getUser();
            console.log('Current user:', user?.id, user?.email);
            
            if (!user) {
                console.log('Not logged in. Please log in at https://contributor.info first');
                document.getElementById('result').innerHTML = 'Not logged in. Please log in at https://contributor.info first';
                return;
            }
            
            // Test member query
            const { data: memberData, error: memberError } = await supabase
                .from('workspace_members')
                .select('workspace_id, role')
                .eq('user_id', user.id);
                
            console.log('Member query result:', memberData, memberError);
            
            if (!memberData || memberData.length === 0) {
                console.log('No workspace memberships found');
                document.getElementById('result').innerHTML = 'No workspace memberships found for user: ' + user.id;
                return;
            }
            
            // Test workspace query
            const workspaceIds = memberData.map(m => m.workspace_id);
            const { data: workspaceData, error: workspaceError } = await supabase
                .from('workspaces')
                .select('*')
                .in('id', workspaceIds)
                .eq('is_active', true);
                
            console.log('Workspace query result:', workspaceData, workspaceError);
            
            document.getElementById('result').innerHTML = `
                <h2>Query Results:</h2>
                <p>User ID: ${user.id}</p>
                <p>Workspaces found: ${workspaceData?.length || 0}</p>
                <pre>${JSON.stringify(workspaceData, null, 2)}</pre>
            `;
        }
        
        window.addEventListener('load', testWorkspaceQuery);
    </script>
</head>
<body>
    <h1>Testing Workspace Loading</h1>
    <div id="result">Loading...</div>
</body>
</html>