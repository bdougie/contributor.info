#!/bin/sh

# Pre-push hook that runs checks before pushing
# This ensures code compiles and passes basic quality checks before pushing

echo "üî® Running pre-push checks..."

# Run TypeScript compilation check
echo "üìù Checking TypeScript compilation..."
npx tsc --noEmit
BUILD_STATUS=$?

# Check if build failed
if [ $BUILD_STATUS -ne 0 ]; then
    echo "‚ùå TypeScript compilation failed! Please fix errors before pushing."
    echo "üí° Run 'npx tsc --noEmit' to see the errors."
    exit 1
fi

echo "‚úÖ TypeScript compilation successful!"

# Lint modified files for better performance
echo "üßπ Linting modified files..."
MODIFIED_FILES=$(git diff HEAD --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$')

if [ -n "$MODIFIED_FILES" ]; then
    echo "Linting files: $MODIFIED_FILES"
    npx eslint "$MODIFIED_FILES" --max-warnings 5
    LINT_STATUS=$?
    
    if [ $LINT_STATUS -ne 0 ]; then
        echo "‚ùå Linting failed! Please fix errors before pushing."
        echo "üí° Run 'npm run lint' to see all issues."
        exit 1
    fi
    echo "‚úÖ Linting passed!"
else
    echo "‚ÑπÔ∏è No modified TypeScript files to lint."
fi

echo "‚úÖ All pre-push checks passed! Proceeding with push..."

exit 0