#!/bin/sh

# Pre-push hook that runs checks before pushing
# This ensures code compiles and passes basic quality checks before pushing

echo "ğŸ”¨ Running pre-push checks..."

# Run TypeScript compilation check
echo "ğŸ“ Checking TypeScript compilation..."
tsc --noEmit
BUILD_STATUS=$?

# Check if build failed
if [ $BUILD_STATUS -ne 0 ]; then
    echo "âŒ TypeScript compilation failed! Please fix errors before pushing."
    echo "ğŸ’¡ Run 'tsc --noEmit' to see the errors."
    exit 1
fi

echo "âœ… TypeScript compilation successful!"

# Lint only staged files for better performance
echo "ğŸ§¹ Linting staged files..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$')

if [ -n "$STAGED_FILES" ]; then
    echo "Linting files: $STAGED_FILES"
    npx eslint $STAGED_FILES --max-warnings 5
    LINT_STATUS=$?
    
    if [ $LINT_STATUS -ne 0 ]; then
        echo "âŒ Linting failed! Please fix errors before pushing."
        echo "ğŸ’¡ Run 'npm run lint' to see all issues."
        exit 1
    fi
    echo "âœ… Linting passed!"
else
    echo "â„¹ï¸ No TypeScript files to lint."
fi

echo "âœ… All pre-push checks passed! Proceeding with push..."

exit 0